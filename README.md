<p align="center">
  <a href="https://commercetools.com/">
    <img alt="commercetools logo" src="https://unpkg.com/@commercetools-frontend/assets/logos/commercetools_primary-logo_horizontal_RGB.png">
  </a>
  <b>Custom application</b>
</p>

An improved template for developing a custom Commercetools Merchant Center application.

Its starting point was https://github.com/commercetools/merchant-center-application-kit,
but is enhanced with 
- Linting
- Typescript
- Script for GraphQL schema download
- Script for auto generation of
  - Typescript types from GraphQL schema
  - Hooks for easy GraphQL querying and mutation. Just add some GraphQL, and you will get a hook to use.
  - This script runs concurrently in npm start, so while developing graphql, it will update hooks instantly.
- Apollo Client IDE setup for auto completion
- Utilities
  - Logger
  - Notifications
  - GetCurrentLocale
- Examples
- Documentation
- Etc.

## Installation

```bash
$ npm install
$ npm start
```

Navigate to http://localhost:3001

## Development

The `custom-application-config.json` is configured to use the HTTP APIs in the GCP-EU region. If you plan to run the Custom Application in another environment, change the cloud identifier accordingly.

## Run tests

Run the following command to run the tests:

```bash
$ yarn test
$ yarn test:watch
```

## Build the production bundles

Run the following command to build the production bundles with webpack:

```bash
$ yarn build
```

## Adjust the configuration for production

The `custom-application-config.json` has a `env.production` configuration object. When you're ready to deploy the application to production, make sure to provide the URL where the Custom Application is hosted.

## Links
- Documentation - https://docs.commercetools.com/custom-applications/
- Template - https://github.com/commercetools/merchant-center-application-kit
- UI-kit - https://uikit.commercetools.com/
- UI-components - https://docs.commercetools.com/custom-applications/components/application-shell
- GraphQL Schema builder - https://graphql-code-generator.com/

## What happens at startup
- index.js - renders EntryPoint component
- views/entry-point/entry-point.tsx
  - sets up redux
  - has a comments example for injecting custom reducers
  - sets up global error handling, which uses redux to handle showing ui notifications for errors
  - adds menu items to the Commercetools menu to enter this app
  - wraps app in ApplicationShell, which handles authentication, sets up apollo client and loads app inside Commercetools ui
  - Adds routes
- routes.tsx - loads MainView
- views/main-view/main-view.tsx - loads Bundle view
- views/bundle/bundle-start.tsx
  - loads products using autogenerated function built from GraphQL query
  - uses loading & error state to handle ui
    - on success - loads ProductsTable with products data
- components/products-table.tsx
  - displays DataTable from Commercetools-uikit with product data
    - defines columns and selection
    - returns selection to parent bundle-start.tsx
- views/bundle/bundle-add.tsx
  - like products-table, this gets product data from bundle-start.tsx
  - is wrapped inside InfoModalPage
    - Note that this UI component is not part of @commercetools-uikit, but is in @commercetools-frontend
  - Loads button views
- views/bundle/bundle-as-attribute-button.tsx
  - Example for mutations that update attributes on product and variants
  - Handles state loading & error
- views/bundle/bundle-as-product-button.tsx
  - Example for mutation that create a new bundle product with master variant
  - Handles state loading & error
